<html>
    <head>
	<link rel="stylesheet" href="https://openlayers.org/en/v5.3.0/css/ol.css" type="text/css">
    <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>

        <title></title>
        <script src="http://openlayers.org/api/OpenLayers.js"></script>
        <script type="text/javascript">



            var lat=40.736851;
            var lon=22.920227;
            var zoom=15;
            var map;

            function init(){
                map = new OpenLayers.Map ("map", {
                controls:[
                    new OpenLayers.Control.Navigation(),
                    new OpenLayers.Control.PanZoomBar(),
                    new OpenLayers.Control.LayerSwitcher(),
                    new OpenLayers.Control.Attribution()],
                    maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
                    maxResolution: 156543.0399,
                    numZoomLevels: 19,
                    units: 'm',
                    projection: new OpenLayers.Projection("EPSG:900913"),
                    displayProjection: new OpenLayers.Projection("EPSG:4326"),

                } );


                map.addLayer(new OpenLayers.Layer.OSM());

                var lonLat = new OpenLayers.LonLat(lon, lat).transform(new OpenLayers.Projection("EPSG:4326"), new OpenLayers.Projection("EPSG:900913"));

                map.setCenter (lonLat, zoom);




				var layer2 = new OpenLayers.Layer.Vector("Test", {
    projection: new OpenLayers.Projection("EPSG:4326"),
    strategies: [new OpenLayers.Strategy.Fixed()],
    protocol: new OpenLayers.Protocol.HTTP({
        url: "map.kml",
        format: new OpenLayers.Format.KML({
            extractStyles: true,
            extractAttributes: true
        })
    })
});

				map.addLayer(layer2);


            }
        </script>

    </head>
    <body onload="init()">
        <div id="map" class="smallmap"></div>
        </div>





<?php

// your config
$dbHost = 'localhost';
$dbUser = 'root';
$dbPass = '121213';
$dbName = 'map_data';
$maxRuntime = 8; // less then your max script execution limit


$deadline = time()+$maxRuntime; 


$con = mysqli_connect($dbHost, $dbUser, $dbPass) OR die('connecting to host: '.$dbHost.' failed: '.mysqli_error($con));
$db_selected = mysqli_select_db($con,$dbName) OR $sql = "CREATE DATABASE map_data";
if (!$db_selected){
if (mysqli_query($con, $sql)) {
    echo "Database created successfully";
	mysqli_select_db($con,$dbName);
} else {
    echo "Error creating database: " . mysqli_error($con);
}
}

$sql = "CREATE TABLE IF NOT EXISTS coordinates (
id int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
name varchar(100) COLLATE utf8_unicode_ci NOT NULL,
coords varchar(999) NOT NULL 
)";
if (mysqli_query($con, $sql)) {
    echo "Table created successfully";
	mysqli_select_db($con,$dbName);
} else {
    echo "Error creating Table: " . mysqli_error($con);
}

/**** Configuration ****/
// The KML file you want to process
$kml_file = 'map.kml';
// The name of the table to create in the SQL file
$table_name = 'dataset';
// Whether to escape the ampersands in the KML; shp2kml doesn't do it
// Change only if you're having problems
$auto_escape = true;
/***************************/
/**** Meat and Potatoes ****/
/***************************/
$kml = file_get_contents($kml_file);
if ($auto_escape)
  $kml = str_replace('&', '&amp;', $kml);
$places_xml = simplexml_load_string($kml);
$headings = array('NAME', 'LONGITUDE', 'LATITUDE','COORDINATES');
$headings_mapped = false;
$data = array();
foreach ($places_xml->Document->Folder[0]->Placemark as $place) {
  $row = array(
    $place->name,
    $place->MultiGeometry->Polygon->outerBoundaryIs->LinearRing->coordinates
  );
  $desc_bits = explode('</tr>', $place->description);
  array_pop($desc_bits);
  array_shift($desc_bits);
  foreach ($desc_bits as $item) {
    if (empty($item))
      continue;
    $item_bits = explode('</td>', $item);
    $item_head = trim(strip_tags($item_bits[0]));
    $item_value = trim(strip_tags($item_bits[1]));
    if (!$headings_mapped) {
      if (strtolower($item_head) != 'name')
        $headings[] = $item_head;
    }
    if (strtolower($item_head) != 'name')
      $row[] = $item_value;
  }
  $headings_mapped = true;
  $data[] = $row;
}

foreach ($data as $row) {
$query = "INSERT INTO `coordinates` (`name`,`coords`) VALUES ('$row[0]','$row[1]')";
if ($con->query($query) === TRUE) {
} else {
    echo "Error: " . $query . "<br>" . $con->error;
}
  
}



?>


    </body>
</html>
